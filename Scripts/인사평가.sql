/* 인사평가질문 */
DROP TABLE appraisalQue CASCADE CONSTRAINTS;

/* 인사평가질문 */
CREATE TABLE appraisalQue (
	Queno NUMBER PRIMARY KEY, /* 질문번호 */
	question VARCHAR2(100) NOT NULL /* 질문 */
);

/* 인사평가답변 */
DROP TABLE appraisalAnswer CASCADE CONSTRAINTS;

/* 인사평가답변 */
CREATE TABLE appraisalAnswer (
	Queno NUMBER, /* 질문번호 */
	point NUMBER, /* 점수 */
	sub CHAR(10), /* 답변자 */
	obj CHAR(10) /* 피평가자 */
);
ALTER TABLE appraisalAnswer ADD PRIMARY KEY (Queno,sub,obj);
ALTER TABLE appraisalAnswer ADD FOREIGN KEY ( Queno ) REFERENCES appraisalQue (Queno);
ALTER TABLE appraisalAnswer ADD FOREIGN KEY ( sub ) REFERENCES Employee (EMPNO);
ALTER TABLE appraisalAnswer ADD FOREIGN KEY ( obj ) REFERENCES Employee (EMPNO);

SELECT * FROM EMPLOYEE e ;
SELECT * FROM appraisalQue ;
SELECT * FROM APPRAISALANSWER ;

--질문 입력할때
--INSERT INTO appraisalQue VALUES (2022||seqforAppraQ.nextval ,'업무 협조도');
--INSERT INTO appraisalQue VALUES (2022||seqforAppraQ.nextval ,'업무시간 준수 정도');
--INSERT INTO appraisalQue VALUES (2022||seqforAppraQ.nextval ,'업무 외 태도');

--답변할때
INSERT INTO APPRAISALANSWER VALUES (20225,4,2022201020,2022301022) ;
INSERT INTO APPRAISALANSWER VALUES (20224,3,2022101001,2022701025) ;
INSERT INTO APPRAISALANSWER VALUES (20225,1,2022101001,2022701025) ;
INSERT INTO APPRAISALANSWER VALUES (20226,5,2022101001,2022701025) ;
INSERT INTO APPRAISALANSWER VALUES (20227,4,2022101001,2022701025) ;

INSERT INTO APPRAISALANSWER VALUES (20224,5,2022201020,2022701025) ;
INSERT INTO APPRAISALANSWER VALUES (20225,5,2022201020,2022701025) ;
INSERT INTO APPRAISALANSWER VALUES (20226,5,2022201020,2022701025) ;
INSERT INTO APPRAISALANSWER VALUES (20227,5,2022201020,2022701025) ;


--e2의 평가결과
SELECT e2.NAME, QUEstion, point, e.name "평가자" FROM APPRAISALQUE aq, APPRAISALANSWER aa, EMPLOYEE e, EMPLOYEE e2  WHERE aq.Queno=aa.QUENO AND e.EMPNO = aa.SUB AND e2.EMPNO = aa.obj ;
SELECT e2.NAME, QUEstion, point 
FROM APPRAISALQUE aq, APPRAISALANSWER aa, EMPLOYEE e, EMPLOYEE e2  
WHERE aq.Queno=aa.QUENO AND e.EMPNO = aa.SUB AND e2.EMPNO = aa.obj ;

--사람별/항목별 평균 점수
SELECT obj, queno,avg(point) FROM APPRAISALANSWER aa GROUP BY obj, QUENO ;
